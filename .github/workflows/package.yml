- name: Package to Windows EXE
  run: |
    # 定义路径变量（提前注释，避免行内注释干扰）
    $JAR_PATH = ".\ruoyi-admin-wms\target\*.jar"
    $OUTPUT_DIR = ".\windows-exe"
    # 获取当前 JRE 路径（JDK17的jre在jdk目录下的jre子目录，或直接用jdk目录作为runtime-image）
    $JDK_PATH = (Get-Item (Get-Command java).Source).Directory.Parent.FullName
    $JRE_PATH = if (Test-Path "$JDK_PATH\jre") { "$JDK_PATH\jre" } else { $JDK_PATH }
    
    # 创建输出目录
    New-Item -Path $OUTPUT_DIR -ItemType Directory -Force
    
    # 获取Jar包名称（提前赋值，避免续行时解析错误）
    $JAR_NAME = (Get-ChildItem $JAR_PATH | Select-Object -First 1).Name
    if (-not $JAR_NAME) {
        Write-Error "未找到Jar包，路径：$JAR_PATH"
        exit 1
    }

    # 执行 jpackage 打包（移除行内注释，统一放在命令外）
    # --win-console：保留控制台窗口（便于查看日志）
    # --win-icon：自定义exe图标（可选，若图标不存在可注释此行）
    jpackage `
      --type exe `
      --name ruoyi-wms `
      --input .\ruoyi-admin-wms\target `
      --main-jar $JAR_NAME `
      --dest $OUTPUT_DIR `
      --runtime-image $JRE_PATH `
      --win-console `
      --app-version 1.0.0 `
      --vendor "ruoyi-wms" `
      --win-icon .\ruoyi-admin-wms\src\main\resources\static\favicon.ico
  shell: pwsh
  env:
    JAVA_HOME: C:\hostedtoolcache\windows\Java_Temurin-Hotspot_jdk\17.0.17-10\x64
    JAVA_HOME_17_X64: C:\hostedtoolcache\windows\Java_Temurin-Hotspot_jdk\17.0.17-10\x64
